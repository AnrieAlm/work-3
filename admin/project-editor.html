<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Editor - Borislav Korabev</title>
    <link rel="stylesheet" href="admin-styles.css">
</head>
<body>
    <header class="admin-header">
        <div class="header-content">
            <a href="dashboard.html" class="btn-back">‚Üê Back to Dashboard</a>
            <h1 id="pageTitle">CREATE NEW PROJECT</h1>
            <button id="logoutBtn" class="btn-logout">LOGOUT</button>
        </div>
    </header>

    <main class="editor-main">
        <div class="editor-container">
            <form id="projectForm" class="project-form">
                <input type="hidden" id="projectId">
                <input type="hidden" id="actionType" value="create">

                <div class="form-section">
                    <h3>Project Details</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectTitle">Project Title *</label>
                            <input type="text" id="projectTitle" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectDescription">Description *</label>
                            <textarea id="projectDescription" rows="4" required></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="projectStatus">Status</label>
                            <select id="projectStatus">
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h3>Project Image</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <div class="image-upload">
                                <label for="projectImage" class="upload-label">
                                    <span class="upload-icon">üì∑</span>
                                    <span class="upload-text">Click to upload image</span>
                                </label>
                                <input type="file" id="projectImage" accept="image/*" style="display: none;">
                                <div class="image-preview-container">
                                    <img id="imagePreview" src="" alt="Preview" style="display: none;">
                                </div>
                                <small class="upload-hint">Recommended: 1200x800px (JPG, PNG, max 5MB)</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save" id="submitBtn">CREATE PROJECT</button>
                    <a href="dashboard.html" class="btn-cancel">CANCEL</a>
                </div>
            </form>
        </div>
    </main>

    <footer class="admin-footer">
        <p>&copy; 2026 Borislav Korabev. Admin Panel.</p>
    </footer>

    <script src="crud.js"></script>
    <script src="admin.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            setupForm();
        });

        function setupForm() {
            const urlParams = new URLSearchParams(window.location.search);
            const action = urlParams.get('action');
            const projectId = urlParams.get('id');

            if (action === 'edit' && projectId) {
                loadProjectForEdit(projectId);
            }

            document.getElementById('projectForm').addEventListener('submit', handleSubmit);
            document.getElementById('projectImage').addEventListener('change', handleImagePreview);
        }

        function loadProjectForEdit(projectId) {
            const project = getProjectById(projectId);
            if (!project) {
                alert('Project not found');
                window.location.href = 'dashboard.html';
                return;
            }

            document.getElementById('pageTitle').textContent = 'EDIT PROJECT';
            document.getElementById('submitBtn').textContent = 'UPDATE PROJECT';
            document.getElementById('actionType').value = 'edit';
            document.getElementById('projectId').value = projectId;

            document.getElementById('projectTitle').value = project.title;
            document.getElementById('projectDescription').value = project.description;
            document.getElementById('projectStatus').value = project.status;

            document.getElementById('imagePreview').src = `../images/${project.image}`;
            document.getElementById('imagePreview').style.display = 'block';
        }

        function handleImagePreview(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('imagePreview').src = event.target.result;
                document.getElementById('imagePreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function handleSubmit(e) {
            e.preventDefault();
            
            const action = document.getElementById('actionType').value;
            const formData = {
                title: document.getElementById('projectTitle').value,
                description: document.getElementById('projectDescription').value,
                status: document.getElementById('projectStatus').value,
                image: 'project-' + Date.now() + '.png' // Placeholder - will be handled by PHP later
            };

            if (action === 'create') {
                createProject(formData);
                alert('Project created successfully!');
            } else {
                const projectId = document.getElementById('projectId').value;
                updateProject(projectId, formData);
                alert('Project updated successfully!');
            }

            window.location.href = 'dashboard.html';
        }
    </script>
</body>
</html>